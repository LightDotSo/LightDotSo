# Copyright 2023-2024 LightDotSo.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model TokenPrice {
  // ---------------------------------------------------------------------------
  // Core
  // ---------------------------------------------------------------------------

  // id        String   @id @default(cuid())
  // timestamp DateTime @default(now())
  timestamp DateTime @id @default(now()) @db.Timestamptz(3)

  // ---------------------------------------------------------------------------
  // Fields
  // ---------------------------------------------------------------------------

  price Float

  // ---------------------------------------------------------------------------
  // One-to-one
  // ---------------------------------------------------------------------------

  // token   Token  @relation(fields: [tokenId], references: [id])
  tokenId String

  // ---------------------------------------------------------------------------
  // One-to-many
  // ---------------------------------------------------------------------------

  // billingOperations BillingOperation[]

  // ---------------------------------------------------------------------------
  // Mappings
  // ---------------------------------------------------------------------------

  // Relations
  @@index([tokenId])
}

model TokenProtocol {
  // ---------------------------------------------------------------------------
  // Core
  // ---------------------------------------------------------------------------

  // id        String   @id @default(cuid())
  // timestamp DateTime @default(now())
  timestamp DateTime @id @default(now()) @db.Timestamptz(3)

  // ---------------------------------------------------------------------------
  // Fields
  // ---------------------------------------------------------------------------

  balanceUSD Float
  debtUSD    Float
  rewardUSD  Float

  // ---------------------------------------------------------------------------
  // One-to-many
  // ---------------------------------------------------------------------------

  // protocol   Protocol @relation(fields: [protocolId], references: [id])
  protocolId String

  // ---------------------------------------------------------------------------
  // Many-to-many
  // ---------------------------------------------------------------------------

  // assetChanges   AssetChange[]
  // strategies     TokenProtocolStrategy[]
  // walletBalances WalletBalance[]

  // ---------------------------------------------------------------------------
  // Mappings
  // ---------------------------------------------------------------------------

  // Relations
  @@index([protocolId])
}

model WalletBalance {
  // ---------------------------------------------------------------------------
  // Core
  // ---------------------------------------------------------------------------

  // id        String   @id @default(cuid())
  // timestamp DateTime @default(now())
  timestamp DateTime @id @default(now()) @db.Timestamptz(3)

  // ---------------------------------------------------------------------------
  // Fields
  // ---------------------------------------------------------------------------

  balanceUSD Float

  // The below fields are from: https://github.com/llamafolio/llamafolio-api
  // Inspired by License: GPL-3.0

  // rewardUSD  Float?
  // debtUSD    Float?
  // apy           Float?
  // apyBase       Float?
  // apyMean30d    Float?
  // ilRisk        Boolean?
  // collateralUSD Float?

  chainId   Decimal
  amount    String?
  stable    Boolean?
  isLatest  Boolean  @default(false)
  isSpam    Boolean  @default(false)
  isTestnet Boolean  @default(false)

  // ---------------------------------------------------------------------------
  // One-to-many
  // ---------------------------------------------------------------------------

  // chain         Chain  @relation(fields: [chainId], references: [id])
  // wallet        Wallet @relation(fields: [walletAddress], references: [address])
  walletAddress String

  // ---------------------------------------------------------------------------
  // None-to-many
  // ---------------------------------------------------------------------------

  // token   Token?  @relation(fields: [tokenId], references: [id])
  tokenId String?

  // tokenProtocol   TokenProtocol? @relation(fields: [tokenProtocolId], references: [id])
  tokenProtocolId String?

  // ---------------------------------------------------------------------------
  // Many-to-many
  // ---------------------------------------------------------------------------

  // billingBalances BillingBalance[]

  // ---------------------------------------------------------------------------
  // Mappings
  // ---------------------------------------------------------------------------

  // Query
  @@index([walletAddress, chainId, amount, isLatest, isSpam, isTestnet])
  // Relations
  @@index([chainId])
  @@index([walletAddress])
  @@index([tokenId])
  @@index([tokenProtocolId])
}
